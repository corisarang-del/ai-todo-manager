# 프롬프트: 할 일 관리 CRUD 기능 구현

**작성시각**: 2026-01-11 15:32

## 사용자 요청

```
@app/page.tsx 이 파일에 supabase와 Next.js App Router를 사용해 할 일 관리기능(CRUD + 검색/필터/정렬)을 실제로 동작하도록 구현해 주세요. 기존에 만들어둔 화면과 컴포넌트(TodoForm, TodoList, TodoCard 등)에 다음 기능을 연결해 완전한 할 일 관리 기능을 완성.

1. 필요한 기능
 - 할 일 생성(Create): 사용자 입력을 받아 현재 로그인한 사용자의 할 일을 Supabase 'todo'테이블에 저장, 생성된 항목을 즉시 목록에 반영해 화면 갱신
 - 할 일 조회(Read): 로그인 한 사용자의 할 일 목록만 조회(user_id기준 필터), 최근 생성순으로 기본 정렬
 - 할 일 수정/삭제(Update/Delete): 본인 소유(user_id가 일치하는 경우)의 할 일만 수정/삭제 가능, 체크박스로 완료/미완료 상태 토글, 삭제 버튼 클릭 시 확인창 표시 후 삭제 실행
 - 검색(Search): 제목(title)에 입력한 키워드가 포함된 항목만 조회
 - 필터(Filter): 완료/미완료 상태 또는 우선순위 기준으로 목록 필터링
 - 정렬(Sort): 생성일, 마감일, 우선순위, 제목 기준으로 정렬옵션 제공

2. 구현조건
 - 데이터 변경(Create/Update/Delete)후에는 목록을 다시 호출해 최신 상태 반영
 - 네트워크 오류나 인증 만료 시 사용자에게 알림 메시지 표시
 - UI구조나 스타일은 유지하되 기능 구현을 위한 최소한의 수정만 허용

gemin.md 파일 이행
```

## 구현 내용

### 1. 타입 정의 (`types/todo.ts`)
- Supabase `todos` 테이블과 일치하는 TypeScript 타입 정의
- `Todo`, `TodoInsert`, `TodoUpdate`, `PriorityLevel` 타입 생성

### 2. CRUD 기능 구현 (`app/page.tsx`)

#### Create (생성)
- `handleFormSubmit` 함수에서 Supabase `insert` 호출
- `user_id`를 현재 로그인 사용자로 자동 설정
- 생성 성공 후 `fetchTodos()` 호출하여 목록 갱신

#### Read (조회)
- `fetchTodos` 함수 추가: Supabase에서 할 일 목록 조회
- `user_id = auth.uid()` 필터 자동 적용 (RLS)
- `created_date` 기준 내림차순 정렬 (최신순)
- 사용자 로그인 후 자동 조회

#### Update (수정)
- 완료 토글: `handleToggleComplete`에서 Supabase `update` 호출
- 전체 수정: `handleFormSubmit`에서 편집 모드일 때 Supabase `update` 호출

#### Delete (삭제)
- `handleDelete` 함수에서 확인창 표시 후 Supabase `delete` 호출
- 삭제 성공 후 `fetchTodos()` 호출

### 3. 검색/필터/정렬
- 기존 클라이언트 측 로직 유지
- 검색: 제목 또는 설명에 키워드 포함 여부
- 필터: 완료/미완료 상태, 우선순위
- 정렬: 생성일, 마감일, 우선순위

### 4. 오류 처리
- 모든 CRUD 작업에 `try-catch` 추가
- 네트워크 오류 및 Supabase 오류 시 사용자에게 알림
- 인증 만료 시 자동 `/login` 리다이렉트

### 5. 로딩 상태 UI
- `isLoadingTodos` 상태 추가
- 데이터 로딩 중 스피너 표시

## 주요 변경사항

### Before (Mock 데이터)
```tsx
const [todos, setTodos] = useState(mockTodos);
```

### After (Supabase 실시간 데이터)
```tsx
const [todos, setTodos] = useState<Todo[]>([]);

const fetchTodos = async () => {
  const { data } = await supabase
    .from("todos")
    .select("*")
    .eq("user_id", user.id)
    .order("created_date", { ascending: false });
  setTodos(data || []);
};
```

## 검증 방법

1. 개발 서버 실행: `pnpm dev`
2. 브라우저에서 `http://localhost:3000` 접속
3. 로그인 후 할 일 생성/조회/수정/삭제 테스트
4. Supabase Dashboard에서 데이터 확인

## 참고 문서
- Supabase 스키마: `schema.sql`
- 개발일지: `개발일지/20260111_할일관리CRUD구현.md`
