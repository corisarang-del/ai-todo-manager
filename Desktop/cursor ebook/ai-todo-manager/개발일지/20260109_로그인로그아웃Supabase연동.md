# 로그인/로그아웃 기능 Supabase 연동

**작성시각**: 2026-01-09 14:36

## 해결하고자 한 문제

`app/login/page.tsx` 파일에 실제 동작하는 Supabase 로그인 기능 구현 및 로그아웃 컴포넌트 생성

### 요구사항
1. 로그인 기능: signInWithPassword 사용
2. 로그아웃 기능: signOut 호출 및 세션 제거
3. 폼 유효성 검사
4. 사용자 친화적 에러 메시지
5. 로딩 상태 처리

## 해결된 것

### 로그인 기능 (app/login/page.tsx)

✅ **Import 추가**
- `useRouter`: 로그인 성공 시 페이지 이동
- `createClient`: Supabase 클라이언트 생성

✅ **폼 유효성 검사**
- 이메일 형식 정규식 검증
- 비밀번호 공백 방지 검증
- 필수 입력 확인

✅ **Supabase 로그인 구현**
```typescript
const { data, error: signInError } = await supabase.auth.signInWithPassword({
  email,
  password,
});
```

✅ **사용자 친화적 에러 처리**
- "이메일 또는 비밀번호가 올바르지 않아"
- "이메일 인증이 필요해. 이메일을 확인해줘"
- "올바른 이메일 형식을 입력해줘"

✅ **로딩 상태 처리**
- `isLoading` 상태로 버튼 비활성화
- "로그인 중..." 텍스트 표시

✅ **성공 처리**
- 성공 메시지 표시
- 1초 후 메인 페이지(/)로 자동 이동
- `router.refresh()`로 서버 컴포넌트 갱신

### 로그아웃 기능 (components/auth/LogoutButton.tsx)

✅ **로그아웃 버튼 컴포넌트 생성**
- 독립적인 재사용 가능 컴포넌트
- `components/auth/LogoutButton.tsx` 파일 생성

✅ **handleLogout 함수 구현**
```typescript
const { error: signOutError } = await supabase.auth.signOut();
```

✅ **로그아웃 성공 처리**
- 세션 자동 제거
- 로그인 페이지(/login)로 리다이렉트
- `router.refresh()`로 서버 컴포넌트 갱신

✅ **에러 처리**
- Alert 컴포넌트로 에러 메시지 표시
- 사용자 친화적 문구

✅ **UI 구현**
- LogOut 아이콘 포함
- "로그아웃 중..." 로딩 상태
- outline 스타일의 작은 버튼

## 해결되지 않은 것

없음

## 향후 개발을 위한 컨텍스트 정리

### 로그인 흐름

1. 사용자가 이메일, 비밀번호 입력
2. 클라이언트 측 유효성 검사
3. Supabase `signInWithPassword` 호출
4. 성공 시 세션 자동 생성 (쿠키에 저장)
5. 메인 페이지(/)로 리다이렉트
6. 서버 컴포넌트가 세션을 확인하여 인증 상태 반영

### 로그아웃 흐름

1. 사용자가 로그아웃 버튼 클릭
2. `supabase.auth.signOut()` 호출
3. 세션 제거 및 쿠키 삭제
4. 로그인 페이지(/login)로 리다이렉트
5. 서버 컴포넌트가 인증되지 않은 상태로 갱신

### LogoutButton 사용 예시

**헤더 컴포넌트에서 조건부 렌더링**:
```tsx
import { LogoutButton } from "@/components/auth/LogoutButton";

// 로그인 상태 확인 후
{user && <LogoutButton />}
```

**메인 페이지에서 사용**:
```tsx
import { LogoutButton } from "@/components/auth/LogoutButton";

// 헤더나 상단 영역에 배치
<div className="flex justify-between items-center">
  <h1>AI Todo Manager</h1>
  <LogoutButton />
</div>
```

### 세션 관리

- Supabase는 쿠키를 사용하여 세션을 자동 관리
- `@supabase/ssr`이 Next.js App Router와 완벽하게 통합
- 서버 컴포넌트에서 `createClient()`로 세션 확인 가능

### 테스트 방법

**로그인 테스트**:
1. 개발 서버 실행: `npm run dev`
2. `/login` 페이지 접속
3. 가입한 이메일, 비밀번호 입력
4. 로그인 버튼 클릭
5. 성공 메시지 확인
6. 메인 페이지(/)로 자동 이동 확인

**로그아웃 테스트**:
1. 로그인 상태에서 LogoutButton 컴포넌트 배치
2. 로그아웃 버튼 클릭
3. 로그인 페이지(/login)로 이동 확인
4. 세션이 제거되어 인증되지 않은 상태 확인

### 다음 단계

1. 헤더나 메인 페이지에 LogoutButton 배치
2. 라우트 보호 (미들웨어 or 서버 컴포넌트에서 세션 확인)
3. 로그인 상태에 따른 UI 분기 처리
4. 사용자 프로필 정보 표시
