# 할 일 관리 CRUD 기능 구현

**작성시각**: 2026-01-11 15:32

## 해결하고자 한 문제

Supabase와 Next.js App Router를 사용해 완전한 할 일 관리 기능(CRUD + 검색/필터/정렬)을 구현. 기존 Mock 데이터를 Supabase 실시간 데이터로 교체하고, 모든 데이터 변경 후 자동 목록 갱신 및 오류 처리 추가

## 해결된 것

### 1. 타입 정의 (`types/todo.ts`)
✅ Supabase `todos` 테이블과 일치하는 TypeScript 타입 정의
- `Todo`: 전체 데이터 타입
- `TodoInsert`: 생성 시 필요한 필드
- `TodoUpdate`: 수정 시 선택적 필드
- `PriorityLevel`: 우선순위 타입

### 2. CRUD 기능 구현 (`app/page.tsx`)

#### ✅ Create (생성)
- `handleFormSubmit` 함수에서 Supabase `insert` 호출
- `user_id`를 현재 로그인 사용자로 자동 설정
- 생성 성공 후 `fetchTodos()` 호출하여 목록 갱신
- 오류 발생 시 사용자에게 알림

#### ✅ Read (조회)
- `fetchTodos` 함수 추가: Supabase에서 할 일 목록 조회
- `user_id = auth.uid()` 필터 자동 적용 (RLS)
- `created_date` 기준 내림차순 정렬 (최신순)
- 사용자 로그인 후 자동 조회 (`useEffect`)
- 로딩 상태 UI 추가

#### ✅ Update (수정)
- **완료 토글**: `handleToggleComplete`에서 Supabase `update` 호출
  - `completed` 상태만 업데이트
  - `completed_at`은 Supabase 트리거가 자동 설정
- **전체 수정**: `handleFormSubmit`에서 편집 모드일 때 Supabase `update` 호출
  - 제목, 설명, 마감일, 우선순위, 카테고리 수정 가능
- 수정 성공 후 `fetchTodos()` 호출

#### ✅ Delete (삭제)
- `handleDelete` 함수에서 확인창 표시 후 Supabase `delete` 호출
- `user_id` 일치 확인 (RLS로 자동 보호)
- 삭제 성공 후 `fetchTodos()` 호출

### 3. 검색/필터/정렬 기능
✅ 기존 클라이언트 측 로직 유지
- **검색**: 제목 또는 설명에 키워드 포함 여부
- **필터**: 완료/미완료 상태, 우선순위
- **정렬**: 생성일, 마감일, 우선순위

### 4. 오류 처리
✅ 모든 CRUD 작업에 `try-catch` 추가
- 네트워크 오류: "네트워크 오류가 발생했어. 인터넷 연결을 확인해줘."
- Supabase 오류: 구체적인 오류 메시지 표시
- 인증 만료: Supabase 클라이언트가 자동으로 `/login`으로 리다이렉트

### 5. 로딩 상태 UI
✅ `isLoadingTodos` 상태 추가
- 데이터 로딩 중 스피너 표시
- 사용자 경험 개선

## 해결되지 않은 것

없음

## 향후 개발을 위한 컨텍스트 정리

### 주요 변경사항

**Before (Mock 데이터)**:
```tsx
const [todos, setTodos] = useState(mockTodos);
```

**After (Supabase 실시간 데이터)**:
```tsx
const [todos, setTodos] = useState<Todo[]>([]);

const fetchTodos = async () => {
  const { data } = await supabase
    .from("todos")
    .select("*")
    .eq("user_id", user.id)
    .order("created_date", { ascending: false });
  setTodos(data || []);
};
```

### Supabase RLS 정책
- 모든 CRUD 작업은 `user_id = auth.uid()` 조건으로 자동 필터링
- 본인 소유 데이터만 조회/수정/삭제 가능
- 클라이언트 코드에서 추가 검증 불필요

### 데이터 흐름
1. 사용자 로그인 → `setUser(session.user)`
2. `useEffect`에서 `user` 변경 감지 → `fetchTodos()` 호출
3. CRUD 작업 → Supabase 호출 → `fetchTodos()` 재호출 → UI 갱신

### 테스트 방법
1. 개발 서버 실행: `npm run dev`
2. 브라우저에서 `http://localhost:3000` 접속
3. 로그인 후 할 일 생성/조회/수정/삭제 테스트
4. Supabase Dashboard > Table Editor > todos 테이블에서 데이터 확인

### 다음 단계
- [ ] AI 기반 할 일 생성 기능 추가
- [ ] 실시간 동기화 (Supabase Realtime)
- [ ] 성능 최적화 (서버 측 검색/필터/정렬)
- [ ] 단위 테스트 작성
