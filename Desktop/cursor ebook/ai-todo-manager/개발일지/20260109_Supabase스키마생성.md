# Supabase 데이터베이스 스키마 생성

**작성시각**: 2026-01-09 08:02

## 해결하고자 한 문제

PRD.md 문서의 데이터 구조를 기반으로 Supabase에서 바로 실행 가능한 SQL 스키마 파일 생성

### 요구사항
- `public.users`: `auth.users(id)`와 1:1로 연결되는 사용자 프로필 테이블
- `public.todos`: 각 사용자(user_id)별 할 일 관리 테이블
- 두 테이블 모두 RLS 활성화 및 정책 (소유자만 읽기/쓰기) 추가
- `schema.sql` 파일로 작성

## 해결된 것

✅ **`schema.sql` 파일 생성 완료**

### 1. users 테이블
- `id`: auth.users(id)와 1:1 외래키 참조 (CASCADE 삭제)
- `email`: 이메일 (UNIQUE)
- `display_name`: 표시 이름
- `created_at`, `updated_at`: 타임스탬프

### 2. todos 테이블
PRD.md의 Todo 데이터 필드를 모두 반영:
- `id`: UUID (PK)
- `user_id`: 사용자 외래키
- `title`: 제목 (필수)
- `description`: 설명
- `created_date`: 생성일
- `updated_at`: 수정일
- `due_date`: 마감일
- `priority`: enum (high/medium/low)
- `category`: text[] 배열
- `completed`: 완료 여부 (boolean)
- `completed_at`: 완료 시각

### 3. RLS 정책
**users 테이블**:
- SELECT: 본인 프로필만 조회
- UPDATE: 본인 프로필만 수정
- INSERT: 회원가입 시 본인 프로필 생성

**todos 테이블**:
- SELECT: 본인 할 일만 조회
- INSERT: 본인 할 일만 생성
- UPDATE: 본인 할 일만 수정
- DELETE: 본인 할 일만 삭제

### 4. 인덱스
- `users.email`
- `todos.user_id`, `due_date`, `priority`, `completed`, `created_date`

### 5. 자동 트리거
- `updated_at` 자동 갱신 (users, todos)
- `completed_at` 자동 설정 (completed 변경 시)
- 신규 사용자 등록 시 `public.users` 자동 생성

## 해결되지 않은 것

없음

## 향후 개발을 위한 컨텍스트 정리

### Supabase에서 실행하는 방법

1. **Supabase Dashboard 접속**
   - 프로젝트 > SQL Editor 이동

2. **schema.sql 내용 복사 & 실행**
   - New Query 생성
   - `schema.sql` 파일 전체 내용 붙여넣기
   - Run 클릭

3. **Table Editor에서 확인**
   - `public.users` 테이블 생성 확인
   - `public.todos` 테이블 생성 확인

### 데이터 조회 예시

```sql
-- 본인의 todos 조회 (RLS 적용됨)
SELECT * FROM public.todos WHERE user_id = auth.uid();

-- 본인 프로필 조회
SELECT * FROM public.users WHERE id = auth.uid();
```

### TypeScript 타입 생성 (선택사항)

```bash
npx supabase gen types typescript --project-id your-project-id > types/supabase.ts
```

### 다음 단계

1. Supabase에서 `schema.sql` 실행
2. 환경변수 설정 확인 (`.env.local`)
3. 로그인/회원가입 UI 구현
4. Todo CRUD API 구현
5. AI Todo 생성 기능 구현
