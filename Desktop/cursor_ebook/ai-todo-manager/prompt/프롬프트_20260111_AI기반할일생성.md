# 프롬프트: AI 기반 할 일 생성 기능 구현

**작성시각**: 2026-01-11 17:28

## 사용자 요청

```
자연어로 입력 된 할 일을 구조화된 데이터로 변환하는 기능을 구현

1. 구현조건
 - 새 할 일 추가 창에서 AI 기반 할 일 생성 기능 연결
 - Gemini API를 AI SDK를 통해 연동
 - 환경변수 GOOGLE_GENERATIVE_AI_API_KEY 사용
 - Next.js API Route로 백엔드 구현
 - 변환 결과는 기존 할 일 데이터 구조(todos 테이블 스키마)와 일치
 - 날짜와 시간을 정확히 추출하고, 시간이 누락된 경우 기본값(예:9:00) 설정
 - 문맥을 기반으로 우선순위 자동 판단
 - 오류 처리 및 입력 검증 로직을 포함해 안정적으로 동작하도록 설계

2. 입력 예시
내일 오후 3시까지 중요한 팀 회의 준비하기

3. 출력예시
{
 title: "팀 회의 준비",
due_date: "2026-01-16",
due_time:"15:00",
priority: "high",
category: "업무"
}

gemini.md 지키기
```

## 구현 내용

### 1. 백엔드 구현 (`app/api/generate-todo/route.ts`)

#### Gemini API 연동
- `@ai-sdk/google` 패키지 사용
- `generateObject` 함수로 구조화된 데이터 생성
- Zod 스키마로 응답 검증

#### 프롬프트 엔지니어링
```typescript
const { object } = await generateObject({
  model: google('gemini-2.0-flash-exp'),
  schema: todoSchema,
  prompt: `당신은 한국어 자연어 입력을 구조화된 할 일 데이터로 변환하는 AI 어시스턴트입니다.

현재 날짜/시간: ${currentDateTime}

사용자 입력: "${input}"

규칙:
1. 제목: 간결하고 명확하게 (10자 이내)
2. 마감일: ISO 8601 형식, 시간 누락 시 09:00
3. 우선순위: high/medium/low 자동 판단
4. 카테고리: 문맥에서 추론

예시:
입력: "내일 오후 3시까지 중요한 팀 회의 준비하기"
출력: {
  "title": "팀 회의 준비",
  "due_date": "2026-01-12T15:00:00+09:00",
  "priority": "high",
  "category": ["업무"]
}
`,
});
```

#### 오류 처리
- API 키 누락 검증
- 입력 검증 (빈 문자열)
- Gemini API 오류 처리
- 사용자 친화적 오류 메시지

### 2. 프론트엔드 구현 (`components/todo/TodoForm.tsx`)

#### 탭 UI 추가
- "직접 입력" / "AI로 생성" 탭
- 편집 모드에서는 직접 입력만 표시

#### AI 생성 UI
```tsx
<TabsContent value="ai">
  <Textarea
    value={aiInput}
    onChange={(e) => setAiInput(e.target.value)}
    placeholder="예: 내일 오후 3시까지 중요한 팀 회의 준비하기"
  />
  <Button onClick={handleAiGenerate}>
    <Sparkles className="w-4 h-4 mr-2" />
    AI로 생성
  </Button>
</TabsContent>
```

#### API 호출 로직
```typescript
const handleAiGenerate = async () => {
  const response = await fetch("/api/generate-todo", {
    method: "POST",
    body: JSON.stringify({ input: aiInput }),
  });
  
  const data = await response.json();
  
  // 생성된 데이터를 폼에 입력
  setTitle(data.title);
  setDueDate(data.due_date);
  setPriority(data.priority);
  setSelectedCategories(data.category);
};
```

### 3. 주요 기능

#### 날짜/시간 파싱
- 상대적 표현: "내일", "다음 주" → 현재 날짜 기준 계산
- 시간 누락: 09:00 기본값
- ISO 8601 형식: `YYYY-MM-DDTHH:mm:ss+09:00`

#### 우선순위 자동 판단
- **high**: "긴급", "중요", "급하게", "빨리"
- **medium**: 일반적인 경우
- **low**: "나중에", "여유있게"

#### 카테고리 추출
- 문맥에서 자동 추론
- 예: "헬스장에서 운동" → ["개인", "건강"]

## 검증 방법

### 1. 패키지 설치
```bash
pnpm add ai @ai-sdk/google
```

### 2. 환경변수 설정
```
GOOGLE_API_KEY=AIzaSyB0CWyBB6TF80tAdlNj5zNQ4_d2H10hGds
GOOGLE_GENERATIVE_AI_API_KEY=AIzaSyB0CWyBB6TF80tAdlNj5zNQ4_d2H10hGds
```

### 3. 개발 서버 실행
```bash
pnpm dev
```

### 4. 실제 테스트 결과

**테스트 케이스: "패캠 강의 완강"**

**서버 로그**:
```
Environment variables check:
GOOGLE_API_KEY exists: true
GOOGLE_API_KEY length: 39
All env keys: [ 'GOOGLE_API_KEY', 'GOOGLE_GENERATIVE_AI_API_KEY' ]
Generated todo data: {
  "title": "패캠 강의 완강",
  "priority": "medium",
  "category": ["학습"]
}
POST /api/generate-todo 200 in 1321ms
```

**UI 결과**:
- ✅ 제목: "패캠 강의 완강" 자동 입력
- ✅ 우선순위: "보통" 자동 설정
- ✅ 카테고리: "학습" 자동 추가
- ✅ 응답 시간: 약 1.3초
- ✅ 폼 필드 자동 업데이트 성공

### 5. 추가 테스트 권장 사항

**케이스 1: 날짜/시간 포함**
- 입력: "내일 오후 3시까지 중요한 팀 회의 준비하기"
- 예상: title="팀 회의 준비", priority="high", due_date=내일 15:00

**케이스 2: 시간 누락**
- 입력: "다음 주 월요일까지 보고서 작성"
- 예상: due_date=다음 주 월요일 09:00

**케이스 3: 우선순위 판단**
- 입력: "급하게 고객 문의 답변하기"
- 예상: priority="high"

**케이스 4: 카테고리 추출**
- 입력: "헬스장에서 운동하기"
- 예상: category=["개인", "건강"]

## 성공 확인

✅ AI 기반 할 일 생성 기능이 정상적으로 작동함
✅ 자연어 입력 → 구조화된 데이터 변환 성공
✅ 제목, 우선순위, 카테고리 자동 추출 검증 완료

## 참고 문서
- 개발일지: `개발일지/20260111_AI기반할일생성.md`
- API Route: `app/api/generate-todo/route.ts`
- TodoForm: `components/todo/TodoForm.tsx`
