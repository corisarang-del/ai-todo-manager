# 프롬프트 - Supabase 스키마 생성

**작성 시각**: 2026-01-09 08:02:21

## 요청 내용

@PRD.md 문서의 데이터 구조를 기준으로 Supabase용 바로 실행 가능한 SQL 쿼리를 생성

### 필수 요소
1. **public.users**: auth.users(id)와 1:1로 연결되는 사용자 프로필 테이블
2. **public.todos**: 각 사용자(user_id)별 할 일 관리 테이블
3. **RLS 활성화**: 두 테이블 모두 RLS 활성화 및 정책 (소유자만 읽기/쓰기) 추가
4. **결과 파일**: `schema.sql` 파일로 작성

### PRD.md 기반 Todo 데이터 필드
| 필드명 | 타입 | 설명 |
|------|-----|------|
| id | uuid | PK |
| user_id | uuid | 사용자 ID |
| title | text | 제목 (필수) |
| description | text | 설명 |
| created_date | timestamptz | 생성일 |
| updated_at | timestamptz | 수정일 |
| due_date | timestamptz | 마감일 |
| priority | enum | high / medium / low |
| category | text[] | 업무, 개인, 학습 등 |
| completed | boolean | 완료 여부 |
| completed_at | timestamptz | 완료 시각 |

## 결과

다음 파일들을 생성:
- `schema.sql`: Supabase SQL 스키마
- `개발일지/20260109_Supabase스키마생성.md`: 개발일지

### schema.sql 구성
1. **users 테이블**: auth.users와 1:1 외래키, CASCADE 삭제
2. **todos 테이블**: PRD.md의 모든 필드 구현, priority_level enum 타입
3. **RLS 정책**: 
   - users: SELECT/UPDATE/INSERT (본인만)
   - todos: SELECT/INSERT/UPDATE/DELETE (본인만)
4. **인덱스**: 성능 최적화용 인덱스 추가
5. **트리거**:
   - updated_at 자동 갱신 (users, todos)
   - completed_at 자동 설정 (completed 변경 시)
   - 신규 사용자 등록 시 public.users 자동 생성

## 특이사항

- Supabase Dashboard > SQL Editor에서 바로 실행 가능
- auth.users 생성 시 public.users 자동 생성 트리거로 사용자 경험 개선
- RLS로 보안 강화 (본인 데이터만 접근)
- category를 TEXT[] 배열로 구현하여 다중 카테고리 지원
